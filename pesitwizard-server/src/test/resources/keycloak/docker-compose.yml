version: '3.8'

# Docker Compose for Keycloak testing
# Run with: docker-compose up -d
# Access Keycloak at: http://localhost:8180
# Admin credentials: admin/admin

services:
  keycloak:
    image: quay.io/keycloak/keycloak:23.0
    container_name: pesit-keycloak
    command: start-dev --import-realm
    environment:
      KEYCLOAK_ADMIN: admin
      KEYCLOAK_ADMIN_PASSWORD: admin
      KC_HTTP_PORT: 8180
    ports:
      - "8180:8180"
    volumes:
      - ./realm-export.json:/opt/keycloak/data/import/realm-export.json:ro
    healthcheck:
      test: [ "CMD-SHELL", "curl -f http://localhost:8180/health/ready || exit 1" ]
      interval: 10s
      timeout: 5s
      retries: 10
      start_period: 30s
  # PostgreSQL for Keycloak (optional, for persistent storage)
  # keycloak-db:
  #   image: postgres:15
  #   container_name: pesit-keycloak-db
  #   environment:
  #     POSTGRES_DB: keycloak
  #     POSTGRES_USER: keycloak
  #     POSTGRES_PASSWORD: keycloak
  #   volumes:
  #     - keycloak-db-data:/var/lib/postgresql/data

  # volumes:
  #   keycloak-db-data:
